<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.12.3 (455520)"/><meta name="author" content="250764090@qq.com"/><meta name="created" content="2018-03-12 13:13:15 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2018-03-22 11:53:35 +0000"/><title>Objective-C atomicity</title></head><body><div>第一篇博客，但愿不是最后一篇。先上一张自己照片再说。</div><div><br/></div><div><img src="mm.jpg" height="540" width="540"/></div><div><br/></div><div>“nonatomic和atomic的区别”是一个热门的iOS问题，我在网上看了很多文章，大致有如下观点：</div><div>1 nonatomic是线程不安全的；</div><div>2 atomic是线程安全的；</div><div>3 atomic未必线程安全；</div><div>4 atomic使用@synchronized语法实现的</div><div><br/></div><div>带着这个疑问，我写了测试程序如下：</div><div><br/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@interface</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> Test : </span><span style="font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSObject</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSInteger</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicInteger;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSInteger</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicInteger;</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@end</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@implementation</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> Test</span></div><div><br style="font-family: Menlo; font-size: 12px; color: rgb(186, 45, 162);"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">- (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)test {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomicInteger</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomicInteger</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomicInteger</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomicInteger</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@end</span></div><div><br/></div><div>在两个property处打断点，可以看到在armv7架构下-O0的具体的实现如下：</div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test nonatomicInteger]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x1070f8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x1070fa</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r2, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x48ca</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x1070fe</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r2, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107102</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r2, pc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107104</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r0, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107106</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r1, [sp]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107108</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+16</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10710a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r2]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10710c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r0, r1</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10710e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [r0]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107110</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107112</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+26</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test setNonatomicInteger:]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107114</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107116</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r3, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x48ae</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10711a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r3, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10711e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r3, pc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107120</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r0, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107122</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r1, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107124</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+16</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r2, [sp]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107126</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [sp]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107128</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10712a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r2, [r3]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10712c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r1, r2</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10712e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+26</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r0, [r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107130</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+28</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107132</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+30</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test atomicInteger]:</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107134</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107136</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107138</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r1, [sp]</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10713a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  ldr    r0, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10713c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x488c</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107140</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: movt   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107144</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+16</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r1, pc</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107146</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107148</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [r0, r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10714a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10714c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test setAtomicInteger:]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10714e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107150</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r0, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107152</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r1, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107154</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r2, [sp]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107156</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  ldr    r0, [sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107158</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: movw   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4870</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10715c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: movt   r1, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107160</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r1, pc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107162</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107164</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r2, [sp]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107166</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r2, [r0, r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107168</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+26</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10716a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+28</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><br/></div><div><span style="font-family: Menlo;">下面对每条指令进行标注，结果如下：</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">Atomicity`-[Test nonatomicInteger]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x1070f8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8        <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; 分配栈空间</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x1070fa</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r2, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x48ca     <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; r2 = </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x</span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">48ca</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x1070fe</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r2, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0        <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">r2 = r2 | </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x0</span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0000</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107102</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r2, pc          <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; r2 = r2 + <span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107106 (armv7三级流水线，pc = pc -&gt; 2)</span></span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">运行完此指令后register read后会发现<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">r2 = 0x0010b9d0  Atomicity`Test._nonatomicInteger</span></span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">，即三条指令通过pc定位到常量区获取到</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">_nonatomicInteger成员变量的地址偏移量存储地址</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107104</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]  <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; 保存参数r0 self放在栈sp+4的位置</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107106</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r1, [sp]        <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; 保存参数r1 self放</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">在栈sp的位置</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107108</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+16</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]  <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; 取出self放在r0</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10710a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r2]        <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">r1 = </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">nonatomicInteger offset, 结果为4 因为<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">class_getInstanceSize([NSObject class])为4，<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">nonatomicInteger往后排</span></span></span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10710c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r0, r1          <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; r0 = r0 + r1, 即r0 = self + 4，r0为&amp;</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">_nonatomicInteger</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10710e</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [r0]        <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; r0 = *r0，即r0 = </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">_nonatomicInteger</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107110</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8        <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">; 回收栈空间</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107112</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+26</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">&gt;: bx     lr              ;<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> 子程序返回</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test setNonatomicInteger:]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107114</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107116</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r3, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x48ae</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10711a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r3, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10711e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r3, pc          ; r3为<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">_nonatomicInteger成员变量的地址偏移量存储地址</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107120</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107122</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r1, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107124</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+16</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r2, [sp]        ; 保存参数r2 n<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">onatomicInteger放在<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">栈sp的位置</span></span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107126</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [sp]        ; 取出<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">n</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">onatomicInteger放在r0</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107128</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10712a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r2, [r3]        ; r2 = <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">nonatomicInteger offset, 结果为4 </span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10712c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r1, r2          ; <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">r1 = r1 + r2, r1为&amp;</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">_nonatomicInteger</span></span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10712e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+26</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r0, [r1]        ; *r1 = r0, <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">_nonatomicInteger = <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-variant-ligatures: no-common-ligatures;">nonatomicInteger;</span></span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107130</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+28</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107132</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+30</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test atomicInteger]:</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107134</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107136</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107138</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r1, [sp]</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10713a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  ldr    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10713c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x488c</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107140</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: movt   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107144</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+16</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r1, pc</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107146</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107148</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [r0, r1]    ; r0 = *(r0 + r1)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10714a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10714c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test setAtomicInteger:]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10714e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  sub    sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107150</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107152</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r1, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107154</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+6</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  str    r2, [sp]</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107156</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  ldr    r0, [sp, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x8]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107158</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: movw   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">#0x4870</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10715c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: movt   r1, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107160</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+18</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    r1, pc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107162</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+20</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107164</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+22</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r2, [sp]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107166</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+24</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r2, [r0, r1]    ; *(r0 + r1) = r2</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x107168</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+26</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: add    sp, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0xc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10716a</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+28</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">&gt;: bx     lr</span></div><div><br/></div><div><span style="font-size: 14px; font-family: Menlo;">通过比较，可以看到对于NSInteger类型的属性，nonatomic比atomic的getter和setter都是多一条指令的，且无任何加锁的逻辑。比起nonatomic，atomic的实现中，偏移量常量地址的获取时机滞后，两条指令合并为一条。下面我们提取出关键指令来做对比：</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">Atomicity`-[Test nonatomicInteger]:</span></div><div><span style="font-size: 12px; font-family: Menlo; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">0x10710c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; font-family: Menlo; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">+20</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">&gt;: add    r0, r1</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">    </span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">      </span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">; r0 = self + 4</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-variant-caps: normal; line-height: normal;">0x10710e</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-variant-caps: normal; line-height: normal;">+22</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">&gt;: ldr    r0, [r0]    </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; r0 = *r0</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">Atomicity`-[Test setNonatomicInteger:]:</span></div><div><span style="font-size: 12px; font-family: Menlo; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">0x10712c</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; font-family: Menlo; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">+24</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">&gt;: add    r1, r2          ; </span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">r1 = self + 4</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x10712e</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+26</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">&gt;: str    r0, [r1]        ; *r1 = r0</span></div><div><span style="font-size: 12px;"><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test atomicInteger]:</span></span></div><div><span style="font-size: 12px; font-family: Menlo; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">0x107148</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;"> &lt;</span><span style="font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">+20</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">&gt;: ldr    r0, [r0, r1]</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">    ; r0 = *(r0 + r1) // ret = *(self + 8)</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test setAtomicInteger:]:</span></div><div><span style="font-size: 12px; font-family: Menlo; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">0x107166</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; font-family: Menlo; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; line-height: normal;">+24</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">&gt;: str    r2, [r0, r1]</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">    ; *(r0 + r1) = r2 <span style="font-size: 12px; font-family: Menlo; line-height: normal;">// *(self + 8) = <span style="font-size: 12px; font-family: Menlo; line-height: normal;">atomicInteger;</span></span></span></div><div><br/></div><div><font style="font-size: 14px;"><span style="font-size: 14px; font-family: Menlo;">与对于每个方法体来说，临界区为成员变量所在的那块sizeof(NSInteger)大小的内存区域，所以可以看出nonatomic的实现等价于</span><span style="font-size: 14px; font-family: Menlo;">atomic的实现。至于</span><span style="font-size: 14px; font-family: Menlo;">偏移量常量地址的获取在前于在后的问题，我们假设这种获取操作与成员变量内存地址读写的操作需要为原子操作的话，这种缩短线程不安全区域的方式只能减少线程不安全的概率，但不能保证线程安全。当然，这种假设是不成立的。</span></font></div><div><span style="font-size: 14px; font-family: Menlo;">我们再看下</span><span style="font-size: 14px; font-family: Menlo;">armv7架构下-Os的具体的实现：</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test nonatomicInteger]:</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352be</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r1, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x4706</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352c2</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r1, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352c6</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  add    r1, pc</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352c8</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352ca</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [r0, r1]</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352cc</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test setNonatomicInteger:]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352ce</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r1, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x46f6</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352d2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r1, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352d6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  add    r1, pc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352d8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352da</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r2, [r0, r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352dc</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test atomicInteger]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352de</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x46ea</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352e2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r1, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352e6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  add    r1, pc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352e8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352ea</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r0, [r0, r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352ec</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Atomicity`-[Test setAtomicInteger:]:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">-&gt;  </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352ee</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+0</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movw   r1, </span><span style="font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x46da</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352f2</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+4</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  movt   r1, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">#0x0</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352f6</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+8</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;:  add    r1, pc</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352f8</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+10</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: ldr    r1, [r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352fa</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+12</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: str    r2, [r0, r1]</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0x352fc</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">+14</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&gt;: bx     lr</span></div><div><br/></div><div><span style="font-size: 14px; font-family: Menlo;">对比可以看出，nonatomic与atomic的实现基本一致。</span></div><div><span style="font-family: Menlo;">小结：</span><span style="font-size: 14px; font-family: Menlo;">对于NSInteger来说，nonatomic和atomic的实现是一致的，且都是线程安全的，这是由指令本身的原子特性所决定的。</span></div><div><br/></div><div><span style="font-family: Menlo;">我们可能会猜想，是不是所有的基础数据类型都类似呢？只要内存区域的操作是原子的，即可无需其他同步机制即可保证线程安全，但是对于占用内存更大的数据类型，一条指令无法完成读取操作的话，就会需要其他同步机制来保证原子操作了。我新增了如下测试代码：</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">typedef</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">struct</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> tagStruct {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSInteger</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> a;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSInteger</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> b;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSInteger</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> c;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSInteger</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> d;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">} Struct;</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">typedef</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">struct</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> tagShortStruct {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">char</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> a;</span></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    short</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> b;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">} ShortStruct;</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@interface</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> Test : </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">NSObject</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px;"><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">char</span></span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicChar;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) <span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">char</span></span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomicChar</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Struct</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicStruct;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Struct</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicStruct;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ShortStruct</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicShortStruct;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ShortStruct</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicShortStruct;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">long</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">long</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicLongLong;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">long</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">long</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicLongLong;</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">float</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicFloat;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">float</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicFloat;</span></div><div><br style="font-family: Menlo; font-size: 12px; color: rgb(186, 45, 162);"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">double</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicDouble;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">double</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicDouble;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@end</span></div><div><br/></div><div><span style="font-family: Menlo;">通过同样的方式得到的结论是：</span></div><div><br/></div><div>对于基础数据类型，如果内存大小小于等于机器字长，则nonatomic和atomic的实现是一样的，且是线程安全的，无论它是整形、浮点型、数组、结构体、联合、指针；如果内存大小大于机器字长，则nonatomic是没有任何同步机制的，而atomic的同步机制通过函数objc_copyStruct中的自旋锁保证。nonatomic的线程不安全性导致在多线程访问时可能发生getter与setter的数据错误。</div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> objc_copyStruct(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *dest, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">const</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *src, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ptrdiff_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> size, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">BOOL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomic, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">BOOL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> hasStrong </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">__unused</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spinlock_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *srcLock = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spinlock_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *dstLock = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (atomic) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        srcLock = &amp;StructLocks[src];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        dstLock = &amp;StructLocks[dest];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        spinlock_t::lockTwo(srcLock, dstLock);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(62, 30, 129); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">memmove</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(dest, src, size);</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (atomic) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        spinlock_t::unlockTwo(srcLock, dstLock);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div>下面我们看下一般的id类型，id的本质是指针，指针大小为机器字长，理论上来说是线程安全的，但由于涉及到了内存管理，所以并没有那么简单。</div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">strong</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicStrongObject;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">strong</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicStrongObject;</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">unsafe_unretained</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicUnsafeUnretainedObject;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">unsafe_unretained</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicUnsafeUnretainedObject;</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">weak</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicWeakObject;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">weak</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicWeakObject;</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">copy</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> nonatomicCopyObject;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">copy</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomicCopyObject;</span></div><div><br/></div><div><span style="font-size: 14px; font-family: Menlo;">我们单独分析每一个方法并用伪代码方式来展示：</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicStrongObject {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_nonatomicStrongObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // 线程安全</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo;"/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setNonatomicStrongObject:(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicStrongObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    objc_storeStrong(</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">+ </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_nonatomicStrongObject, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomicStrongObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">); // <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">objc_storeStrong非线程安全函数</span></span></div><div><span style="font-size: 12px; font-family: Menlo;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicStrongObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_getProperty(</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_atomicStrongObject, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">YES</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // YES，线程安全</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setAtomicStrongObject:(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicStrongObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_setProperty_atomic(</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">atomicStrongObject, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_atomicStrongObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">); // <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_setProperty_atomic线程安全</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicUnsafeUnretainedObject {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(79, 129, 135); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_nonatomicUnsafeUnretainedObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // 线程安全，但指针不一定安全</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo;"/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setNonatomicUnsafeUnretainedObject:(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicUnsafeUnretainedObject {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(79, 129, 135); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_nonatomicUnsafeUnretainedObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> = nonatomicUnsafeUnretainedObject; <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// 线程安全，<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">但指针不一定安全</span></span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicUnsafeUnretainedObject {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(79, 129, 135); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_atomicUnsafeUnretainedObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // 与<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomic实现一致</span></span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo;"/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setAtomicUnsafeUnretainedObject:(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicUnsafeUnretainedObject {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(79, 129, 135); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_atomicUnsafeUnretainedObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> = atomicUnsafeUnretainedObject; <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// 与</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomic实现一致</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicWeakObject {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_autoreleaseReturnValue(</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_loadWeakRetained(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> + OBJC_IVAR_$_Test$_nonatomicWeakObject</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">))</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">objc_loadWeakRetained线程安全</span></span></div><div><span style="font-size: 12px; font-family: Menlo;">}</span></div><div><br style="font-family: Menlo;"/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setNonatomicWeakObject:(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicWeakObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_storeWeak(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> + OBJC_IVAR_$_Test$_nonatomicWeakObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomicWeakObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">); // <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_storeWeak线程安全</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicWeakObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_autoreleaseReturnValue(</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_loadWeakRetained(</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> + OBJC_IVAR_$_Test$_atomicWeakObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">))</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // 与<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomic实现一致</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo;"/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setAtomicWeakObject:(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicWeakObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_storeWeak(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> + OBJC_IVAR_$_Test$_atomicWeakObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">atomicWeakObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">); <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// 与</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomic实现一致</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo;"/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicCopyObject {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_getProperty(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_nonatomicCopyObject, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">NO</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // 线程不安全</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setNonatomicCopyObject:(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)nonatomicCopyObject {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_setProperty_nonatomic_copy</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomicCopyObject</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_nonatomicCopyObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">); <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// 线程不安全</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicCopyObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_getProperty(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_atomicCopyObject, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">YES</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; // 线程安全，与strong实现一致</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setAtomicCopyObject:(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)atomicCopyObject {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_setProperty_atomic_copy</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">(</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">atomicCopyObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_atomicCopyObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">); <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// 线程安全</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_storeStrong(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *location, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> obj)</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> prev = *location;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (obj == prev) {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_retain</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(obj);</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    *location = obj;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_release</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(prev);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> objc_getProperty(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ptrdiff_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> offset, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">BOOL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomic) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (offset == </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> object_getClass(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Retain release world</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *slot = (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">*) ((</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">char</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">*)</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> + offset);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (!atomic) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *slot;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Atomic retain release world</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spinlock_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&amp; slotlock = PropertyLocks[slot];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    slotlock.lock();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> value = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_retain</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(*slot);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    slotlock.unlock();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// for performance, we (safely) issue the autorelease OUTSIDE of the spinlock.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return&nbsp;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_autoreleaseReturnValue</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(value);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> objc_setProperty_atomic(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> newValue, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ptrdiff_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> offset)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">reallySetProperty</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, newValue, offset, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">true</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">false</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">false</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_loadWeakRetained(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *location)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> obj;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> result;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Class</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> cls;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SideTable</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *table;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> retry:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// fixme std::atomic this load</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    obj = *location;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (!obj) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return&nbsp;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (obj-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">isTaggedPointer</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">()) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> obj;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    table = &amp;SideTables()[obj];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    table-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">lock</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (*location != obj) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        table-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">unlock</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">goto</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> retry;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    result = obj;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    cls = obj-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ISA</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (! cls-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">hasCustomRR</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">()) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Fast case. We know +initialize is complete because</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// default-RR can never be set before then.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(120, 73, 42); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">assert</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(cls-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">isInitialized</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">());</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (! obj-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">rootTryRetain</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">()) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            result = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Slow case. We must check for +initialize and call it outside</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// the lock if necessary in order to avoid deadlocks.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (cls-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">isInitialized</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">() || </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_thisThreadIsInitializingClass</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(cls)) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">BOOL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (*tryRetain)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) = (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">BOOL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(*)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">))</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">                class_getMethodImplementation(cls, SEL_retainWeakReference);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> ((</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">IMP</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)tryRetain == </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(62, 30, 129); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_objc_msgForward</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">                result = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (! (*tryRetain)(obj, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL_retainWeakReference</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">                result = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            table-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">unlock</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_class_initialize</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(cls);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">goto</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> retry;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    table-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">unlock</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> result;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">template</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> &lt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">HaveOld</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> haveOld, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">HaveNew</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> haveNew,</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">          </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">CrashIfDeallocating</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> crashIfDeallocating&gt;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">static</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">storeWeak(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *location, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_object</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *newObj)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(120, 73, 42); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">assert</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(haveOld  ||  haveNew);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (!haveNew) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(120, 73, 42); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">assert</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(newObj == </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Class</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> previouslyInitializedClass = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> oldObj;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SideTable</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *oldTable;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SideTable</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *newTable;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Acquire locks for old and new values.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Order by lock address to prevent lock ordering problems. </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Retry if the old value changes underneath us.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> retry:</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (haveOld) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        oldObj = *location;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        oldTable = &amp;SideTables()[oldObj];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    } </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        oldTable = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (haveNew) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        newTable = &amp;SideTables()[newObj];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    } </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        newTable = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SideTable</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">::lockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable);</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (haveOld  &amp;&amp;  *location != oldObj) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SideTable</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">::unlockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">goto</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> retry;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Prevent a deadlock between the weak reference machinery</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// and the +initialize machinery by ensuring that no </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// weakly-referenced object has an un-+initialized isa.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (haveNew  &amp;&amp;  newObj) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Class</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> cls = newObj-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">getIsa</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (cls != previouslyInitializedClass  &amp;&amp;  </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            !((</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_class</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *)cls)-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">isInitialized</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">()) </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SideTable</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">::unlockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_class_initialize</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_class_getNonMetaClass</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(cls, (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)newObj));</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// If this class is finished with +initialize then we're good.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// If this class is still running +initialize on this thread </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// (i.e. +initialize called storeWeak on an instance of itself)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// then we may proceed but it will appear initializing and </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// not yet initialized to the check above.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Instead set previouslyInitializedClass to recognize it on retry.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            previouslyInitializedClass = cls;</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">goto</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> retry;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        }</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Clean up old value, if any.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (haveOld) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        weak_unregister_no_lock(&amp;oldTable-&gt;weak_table, oldObj, location);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Assign new value, if any.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (haveNew) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        newObj = (objc_object *)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            weak_register_no_lock(&amp;newTable-&gt;weak_table, (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)newObj, location, </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">                                  crashIfDeallocating);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// weak_register_no_lock returns nil if weak store should be rejected</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Set is-weakly-referenced bit in refcount table.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (newObj  &amp;&amp;  !newObj-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">isTaggedPointer</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">()) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">            newObj-&gt;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">setWeaklyReferenced_nolock</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// Do not set *location anywhere else. That would introduce a race.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        *location = (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)newObj;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// No new value. The storage is not changed.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SideTable</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">::unlockTwo&lt;haveOld, haveNew&gt;(oldTable, newTable);</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)newObj;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> objc_setProperty_nonatomic_copy(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> newValue, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ptrdiff_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> offset)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">reallySetProperty</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, newValue, offset, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">false</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">true</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">false</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> objc_setProperty_atomic_copy(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> newValue, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ptrdiff_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> offset)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">reallySetProperty</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, newValue, offset, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">true</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">true</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">false</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">static</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">inline</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> reallySetProperty(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> newValue, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ptrdiff_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> offset, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">bool</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomic, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">bool</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> copy, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">bool</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> mutableCopy) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">__attribute__</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">((always_inline));</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">static</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">inline</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> reallySetProperty(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">SEL</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_cmd</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> newValue, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(112, 61, 170); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ptrdiff_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> offset, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">bool</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> atomic, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">bool</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> copy, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">bool</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> mutableCopy)</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (offset == </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(39, 42, 216); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        object_setClass(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, newValue);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> oldValue;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *slot = (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">*) ((</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">char</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">*)</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">self</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> + offset);</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (copy) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        newValue = [newValue </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">copyWithZone</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">:</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    } </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (mutableCopy) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        newValue = [newValue </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">mutableCopyWithZone</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">:</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nil</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    } </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (*slot == newValue) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        newValue = </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_retain</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(newValue);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (!atomic) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        oldValue = *slot;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        *slot = newValue;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    } </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">else</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spinlock_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">&amp; slotlock = PropertyLocks[slot];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        slotlock.lock();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        oldValue = *slot;</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        *slot = newValue;        </span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        slotlock.unlock();</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_release</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(oldValue);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-family: Menlo; font-size: 14px;">小结：</span></div><div><span style="font-family: Menlo; font-size: 14px;">weak是线程安全的，nonatomic和atomic实现一致；</span></div><div><span style="font-family: Menlo; font-size: 14px;">unsafe_unretained是线程安全的，但本身指针的合法性自身无法保证；</span></div><div><span style="font-family: Menlo; font-size: 14px;">strong的setter在</span><span style="font-family: Menlo; font-size: 14px;">nonatomic情况下</span><span style="font-family: Menlo; font-size: 14px;">是非线程安全的，atomic情况下是线程安全的，getter都是线程安全的；</span></div><div><span style="font-family: Menlo; font-size: 14px;">copy与</span><span style="font-family: Menlo; font-size: 14px;">strong的类似，<span style="font-family: Menlo; font-size: 14px;">在</span><span style="font-family: Menlo; font-size: 14px;">nonatomic情况下</span><span style="font-family: Menlo; font-size: 14px;">是非线程安全的，atomic情况下是线程安全的。</span></span></div><div><br/></div><div><span style="font-family: Menlo; font-size: 14px;">具体我们来看下这几个函数的线程不安全性，以及产生的后果。</span></div><div><font style="font-size: 14px;" face="Menlo"><span style="font-family: Menlo; font-size: 14px; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal;">objc_storeStrong代码如下：</span></font></div><div><br/></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_storeStrong(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *location, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> obj)</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> prev = *location;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (obj == prev) {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_retain</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(obj);</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    *location = obj;</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_release</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(prev);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-family: Menlo; font-size: 14px;">假如，self.nonatomicStrong是a，此时同时两个线程分别设置</span><span style="font-family: Menlo; font-size: 14px;">self.nonatomicStrong = b与<span style="font-family: Menlo; font-size: 14px;">self.nonatomicStrong = c，两个线程都执行到了<span style="font-family: Menlo; font-size: 14px; color: rgb(49, 89, 93); line-height: normal;">objc_retain</span><span style="font-family: Menlo; font-size: 14px; color: rgb(49, 89, 93); line-height: normal;">(obj);</span></span></span></div><div><span style="font-family: Menlo; font-size: 14px;">线程1</span></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_storeStrong(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *location, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> obj) // location为self+<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">OBJC_IVAR_$_Test$_nonatomicStrongObject，obj为b</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">{</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> prev = *location; // prev为a</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (obj == prev) {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">        </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    }</span></div><div><span style="font-size: 12px; font-family: Menlo; line-height: normal;">-&gt;  </span><span style="font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; line-height: normal;">objc_retain</span><span style="font-size: 12px; font-family: Menlo; line-height: normal;">(obj);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    *location = obj;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_release</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(prev);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><span style="font-family: Menlo; font-size: 14px;">线程2</span></div><div><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_storeStrong(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *location, </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> obj) <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// location为self+</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_nonatomicStrongObject，obj为c</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">{</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> prev = *location; <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// prev为a</span></span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">if</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (obj == prev) {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">        </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    }</span></div><div><span style="font-size: 12px; font-family: Menlo; line-height: normal;">-&gt;  </span><span style="font-size: 12px; color: rgb(49, 89, 93); font-family: Menlo; line-height: normal;">objc_retain</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); font-family: Menlo; line-height: normal;">(obj);</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    *location = obj;</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(49, 89, 93); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">objc_release</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(prev);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><font style="font-size: 14px;"><span style="font-size: 14px; font-family: Menlo;">然后跑完线程1，b做retain， </span><span style="font-size: 14px; font-family: Menlo; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal;">_nonatomicStrongObject = b，a做release；</span><span style="font-size: 14px; font-family: Menlo;">再跑完线程2，c做retain， </span><span style="font-size: 14px; font-family: Menlo; line-height: normal;">_nonatomicStrongObject = c，a做release。结果与我们预期的结果并不一致，a释放了两次，而本来应该释放的b或c没有被释放而产生了内存泄漏，如果a在运行之前的retainCount就是1的话，就会立即发生崩溃；如果后续有时机把a释放完全的话，也会在最后一次release动作的时候发生崩溃，除非a永远不会被释放。总之结果已经不可预期了。至于<span style="font-size: 14px; font-family: Menlo; line-height: normal; color: rgb(0, 0, 0); font-variant-caps: normal;">*location = obj;在SMP系统的并行也会在最终有个有先有后的结果，这个应该是MMU的事情，我们不需要关心CPU缓存等具体细节了。</span></span></font></div><div><br/></div><div><span style="font-family: Menlo; font-size: 14px;">临近尾声，我们来看看特殊的id类型，block。block在内存上默认修饰符是copy，如果是strong，也会转换成copy。</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">copy</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^nonatomicCopyBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">copy</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^atomicCopyBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><br style="font-family: Menlo; font-size: 12px; color: rgb(186, 45, 162);"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; text-decoration: underline;">@</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">retain</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^nonatomicRetainBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; text-decoration: underline;">@</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">retain</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^atomicRetainBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><br style="font-family: Menlo; font-size: 12px; color: rgb(186, 45, 162);"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">weak</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^nonatomicWeakBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">weak</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^atomicWeakBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><br style="font-family: Menlo; font-size: 12px; color: rgb(186, 45, 162);"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">nonatomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">unsafe_unretained</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^nonatomicUnsafeUnretainedBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">@property</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">atomic</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">unsafe_unretained</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">) </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(^atomicUnsafeUnretainedBlock)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">);</span></div><div><br/></div><div><span style="font-size: 14px; font-family: Menlo;">我们发现copy、weak、unsafe_unretained的block并没有特殊性，而只有retain是特殊的，这也是ARC下retain和strong的唯一区别：</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (^)(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">))nonatomicRetainBlock {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    <span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_nonatomicRetainBlock</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">; // 和</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomicStrongObject</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">一样， 线程安全</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setNonatomicRetainBlock:(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> (^)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">))</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomicRetainBlock</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> {</span></div><div><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">    </span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">objc_retainBlock(</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">nonatomicRetainBlock</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">)</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">;</span></div><div>       <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;"> (^</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">prev</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)) = </span> <span style="font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_nonatomicRetainBlock<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">; <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// 线程不安全</span></span></span></div><div><span style="font-size: 12px;"><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    <span style="color: rgb(79, 129, 135); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">_nonatomicRetainBlock </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">=</span><span style="color: rgb(79, 129, 135); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">nonatomicRetainBlock; <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">// 线程不安全</span></span></span></span></div><div><span style="font-size: 12px;"><span style="font-size: 12px;"><span style="font-size: 12px;"><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    <span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">objc_release(</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">prev</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">);</span></span></span></span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (^)(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">))atomicRetainBlock {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">return&nbsp;</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;" /><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_getProperty(</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_atomic</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">RetainBlock</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">YES</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">; // 和</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">atomicStrongObject<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">一样，</span></span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">YES，线程安全</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">- (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">)setAtomicRetainBlock:(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;"> (^)(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">void</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;">))</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">atomicRetainBlock</span><span style="color: rgb(0, 0, 0); font-family: Menlo; font-size: 12px; font-variant-caps: normal; line-height: normal;"> {</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">    <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_setProperty_atomic(</span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">self</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-variant-caps: normal; line-height: normal;">_cmd</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">atomicRetainBlock</span></span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">, </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">OBJC_IVAR_$_Test$_atomic<span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">RetainBlock</span></span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">); // <span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">和</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">atomicStrongObject</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">一样，</span></span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">objc_setProperty_atomic线程安全</span></span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-variant-caps: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> objc_retainBlock(</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> x) {</span></div><div><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">return</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">id</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(62, 30, 129); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">_Block_copy</span><span style="font-size: 12px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(x);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><span style="font-family: Menlo;">最后，源码中有个叫</span><span style="font-size: 12px; font-family: Menlo; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal;">objc_copyCppObjectAtomic</span><span style="font-family: Menlo; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal;">的函数，这是我们遗漏的一种属性，与</span><span style="font-size: 12px; font-family: Menlo; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal;">objc_copyStruct</span><span style="font-family: Menlo; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal; font-style: normal; font-weight: normal; font-size: 14px;">类似。</span></div><div><br/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> objc_copyCppObjectAtomic(</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *dest, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">const</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *src, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (*copyHelper) (</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *dest, </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">const</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;" /><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(186, 45, 162); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">void</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *source)) {</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spinlock_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *srcLock = &amp;CppObjectLocks[src];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(79, 129, 135); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spinlock_t</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> *dstLock = &amp;CppObjectLocks[dest];</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    spinlock_t::lockTwo(srcLock, dstLock);</span></div><div><br style="font-family: Menlo; font-size: 12px;"/></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 132, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">// let C++ code perform the actual copy.</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    copyHelper(dest, src);</span></div><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    </span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">    spinlock_t::unlockTwo(srcLock, dstLock);</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Menlo; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">}</span></div><div><br/></div><div><font style="font-size: 14px;"><span style="font-size: 14px; font-family: Menlo;">总结：</span></font></div><div><span style="font-family: Menlo;">1 非OC对象，无需多条指令读写内存的短数据类型，nonatomic和atomic无区别，都具有原子性，都是线程安全的；</span></div><div><span style="font-family: Menlo;">2 </span><span style="font-family: Menlo;">非OC对象，需多条指令读写内存的长数据类型，<span style="font-family: Menlo;">nonatomic不</span><span style="font-family: Menlo;">具有原子性</span><span style="font-family: Menlo;">，是线程不安全的，atomic</span><span style="font-family: Menlo;">具有原子性，是线程安全的；</span></span></div><div><span style="font-family: Menlo;">3 OC对象，没有内存关系的unsafe_unretained、assign，<span style="font-family: Menlo;">nonatomic和atomic无区别，都具有原子性，都是线程安全的；</span></span></div><div><span style="font-family: Menlo;">4 OC对象，weak，<span style="font-family: Menlo;">nonatomic和atomic无区别，都具有原子性，都是线程安全的；</span></span></div><div><span style="font-family: Menlo;">5 OC对象，strong、copy、</span><span style="font-family: Menlo;">retain</span><span style="font-family: Menlo;">，</span><span style="font-family: Menlo;">nonatomic setter不</span><span style="font-family: Menlo;">具有原子性</span><span style="font-family: Menlo;">，是线程不安全的，</span><span style="font-family: Menlo;">nonatomic getter</span><span style="font-family: Menlo;">具有原子性</span><span style="font-family: Menlo;">，是线程安全的，</span><span style="font-family: Menlo;">atomic</span><span style="font-family: Menlo;">具有原子性，是线程安全的；</span></div><div><span style="font-family: Menlo;">6 同步机制采用的是自旋锁，并不是递归锁@synchronized语句（</span><font style="font-size: 14px;"><span style="font-family: Menlo; font-size: 14px; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal;">objc_sync_enter与</span><span style="font-family: Menlo; font-size: 14px; color: rgb(0, 0, 0); font-variant-caps: normal; line-height: normal;">objc_sync_exit</span></font><span style="font-family: Menlo;">）。</span></div><div><span style="font-family: Menlo;">7 对于线程不安全的基础数据类型，多线程访问可能会发生数据错误，<span style="font-family: Menlo;">对于线程不安全的id类型，多线程访问可能会发生引用计数错误。</span></span></div><div><br/></div></body></html>